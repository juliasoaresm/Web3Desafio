<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <div th:insert="~{frags/misc :: bootstrap}"></div>
    <title>Document</title>
  </head>
  <body>
    <p class="h2">Serviços cadastrados no sistema</p>
    <small th:text="${msg}"></small><br />
    <button
      class="btn btn-success"
      data-bs-toggle="modal"
      data-bs-target="#modalcadastro"
    >
      new
    </button>

    <table class="table table-striped">
      <tr class="table-dark">
        <th>código</th>
        <th>nome</th>
        <th>tipo</th>
        <th>descrição</th>
        <th>ações</th>
      </tr>
      <tr th:each="s : ${servicos}" th:object="${s}">
        <td th:text="*{codigo}"></td>
        <td th:text="*{nome}"></td>
        <td th:text="*{tipo}"></td>
        <td th:text="*{descricao}"></td>
        <td>
          <a
            href="#"
            class="btn btn-info"
            th:href="@{/servico/save/{id}(id=*{codigo})}"
            >edit</a
          >
          <a
            href="#"
            th:href="@{/servico/delete/(id=*{codigo})}"
            class="btn btn-dark"
            >delete</a>
        </td>
      </tr>
    </table>

    <div class="modal fade" id="modalcadastro" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Modal title</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!--<div
              th:if="${servico.codigo == 0}"
              th:insert="~{frags/forms :: servico('new')}"
            ></div>
            <div
              th:unless="${servico.codigo == 0}"
              th:insert="~{frags/forms :: servico('update')}"
            ></div>-->
            <div th:insert="~{frags/forms :: generic('Post','/servico/save',${servico})}"></div>
          </div>
        </div>
      </div>
    </div>

    <!--<div th:insert="~{frags/forms :: generic('post','/servico/save',${servico})}">--></div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <div th:unless="${servico.codigo == 0}">
      <script>
        const modal = document.getElementById("modalcadastro");

        const mymodal = new bootstrap.Modal(modal);
        mymodal.show();

        modal.addEventListener("hide.bs.modal", function () {
          location.href = "/servico";
        });
      </script>
    </div>
  </body>
</html>
